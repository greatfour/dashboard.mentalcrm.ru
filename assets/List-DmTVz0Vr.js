import{h as D}from"./moment-zH0z38ay.js";import{_ as R}from"./BaseCard.vue_vue_type_script_setup_true_lang-CXnM25sU.js";import{_ as Y}from"./BaseTable.vue_vue_type_style_index_0_lang-BdcfvIXs.js";import{_ as A}from"./BaseLoader.vue_vue_type_script_setup_true_lang-DEUrq8Kn.js";import{_ as H}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-C_OQyfJV.js";import{d as L,u as B,i as j,k as v,n as E,o as p,c as V,e as l,w as a,f,t as o,b as t,V as w,af as q,aE as z,a as r,ak as J,an as $,ad as Z,I as G,p as C,aF as K,m as N,J as O,al as Q,F as U,r as T,h as W,av as X,B as ee,Z as I}from"./index-rKzDa4TW.js";import{u as F}from"./Client-V112gc0S.js";import{u as te}from"./Rules-DZKrv_I-.js";import{U as ae}from"./user-1-B0DTw7e0.js";import"./lodash-CyvJ_RrL.js";const se={class:"title text-white"},le={class:"tw-mb-1 tw-text-base"},oe={class:"tw-mb-3 tw-flex tw-items-center"},ie={class:"tw-mb-1 tw-text-base"},ne={class:"tw-mb-3 tw-flex tw-items-center"},re={class:"tw-mb-1 tw-text-base"},ue={class:"tw-flex tw-items-start"},ce=L({__name:"InviteClientModal",setup(k){const{t:s}=B(),u=F(),n=j(),{emailRules:b}=te(),_=v(""),g=v(!1),h=v(!1),y=v(!1),c=v(!1),d=E(()=>"https://dashboard.mentalcrm.ru"),e=async(M="")=>{try{await navigator.clipboard.writeText(M),n.createNotification({title:s("notification.copyMessage"),color:"success"})}catch{n.createNotification({title:s("notification.errorNotification"),color:"error"})}},x=()=>{c.value=!0;try{u.inviteClientApi({email:_.value}),n.createNotification({title:s("notification.emailInviteMessage"),color:"success"}),y.value=!0,setTimeout(()=>y.value=!1,3e3)}catch{n.createNotification({title:s("notification.errorNotification"),color:"error"})}c.value=!1};return(M,i)=>{const S=T("CopyIcon"),P=T("router-link");return p(),V(U,null,[l(w,{onClick:i[0]||(i[0]=m=>h.value=!0),color:"primary"},{default:a(()=>[f(o(t(s)("client.invite")),1)]),_:1}),l(Q,{modelValue:h.value,"onUpdate:modelValue":i[6]||(i[6]=m=>h.value=m),width:"600"},{default:a(()=>[l(q,null,{default:a(()=>[l(z,{class:"pa-4 bg-primary"},{default:a(()=>[r("p",se,o(t(s)("client.invite")),1)]),_:1}),l(J,{class:"pa-4"},{default:a(()=>[r("p",le,o(t(s)("client.inviteLink")),1),r("div",oe,[l($,{value:`${d.value}#/auth/register?code=${t(n).user.code}`,class:"mr-5","hide-details":"",disabled:""},null,8,["value"]),l(w,{onClick:i[1]||(i[1]=m=>e(`${d.value}#/auth/register?code=${t(n).user.code}`)),variant:"tonal",icon:""},{default:a(()=>[l(S)]),_:1})]),r("p",ie,o(t(s)("client.code")),1),r("div",ne,[l($,{value:t(n).user.code,class:"mr-5","hide-details":"",disabled:""},null,8,["value"]),l(w,{onClick:i[2]||(i[2]=m=>e(t(n).user.code)),variant:"tonal",icon:""},{default:a(()=>[l(S)]),_:1})]),r("p",re,o(t(s)("email")),1),l(Z,{onSubmit:G(x,["prevent"]),"lazy-validation":"",modelValue:g.value,"onUpdate:modelValue":i[4]||(i[4]=m=>g.value=m)},{default:a(()=>[r("div",ue,[l($,{modelValue:_.value,"onUpdate:modelValue":i[3]||(i[3]=m=>_.value=m),rules:t(b),class:"mr-5",required:""},null,8,["modelValue","rules"]),y.value?(p(),C(w,{key:1,color:"success",class:"tw-mt-1.5","prepend-icon":"mdi-check-circle"},{default:a(()=>[f(o(t(s)("client.successEmail")),1)]),_:1})):(p(),C(w,{key:0,loading:c.value,disabled:!g.value,class:"tw-mt-1.5",color:"primary",type:"submit"},{default:a(()=>[f(o(t(s)("client.inviteClient")),1)]),_:1},8,["loading","disabled"]))])]),_:1},8,["modelValue"])]),_:1}),l(K,{class:"pa-4"},{default:a(()=>[t(n).user.subscription==="FREE"?(p(),C(P,{key:0,to:{name:"Plans"}},{default:a(()=>[l(w,{color:"primary",class:"update-btn bg-primary tw-mr-2"},{default:a(()=>[f(o(t(s)("update")),1)]),_:1})]),_:1})):N("",!0),l(O),l(w,{onClick:i[5]||(i[5]=m=>h.value=!1),color:"error"},{default:a(()=>[f(o(t(s)("close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});function de(){const k=W();return{openPage:(u="/",n=void 0)=>{k.push({name:u,query:n})}}}const me={class:"tw-mb-3 tw-flex tw-justify-end"},pe=["src"],fe={class:"tw-max-w-60 tw-truncate"},ve={class:"tw-w-full tw-max-w-80 tw-overflow-hidden"},_e={key:0},we=10,Ue=L({__name:"List",setup(k){const{t:s}=B(),u=F(),{openPage:n}=de(),b=v(1),_=v([]),g=v(!0),h=E(()=>[{text:"#",value:"avatar"},{text:s("client.name"),value:"name"},{text:s("client.tags"),value:"tags"},{text:s("client.phone"),value:"phone"},{text:s("client.lastSession"),value:"lastSession"}]);X(()=>{_.value=[{label:"Name",key:"name",value:null},{label:"Tags",key:"tags",value:null,options:u.tagsList.map(c=>({title:c.name,props:{value:c.id}}))}]});const y=async c=>{await Promise.all([c(),u.getTags()]),g.value=!1};return(c,d)=>(p(),V(U,null,[l(H,{title:"sidebar.clientList"}),l(A,{isUpdate:g.value},{default:a(()=>[l(R,null,{default:a(()=>[r("div",me,[l(ce)]),l(Y,{onUpdate:t(u).getClients,onCreated:y,onClickRow:d[0]||(d[0]=e=>t(n)("Clients Details",{id:e.id})),page:b.value,"onUpdate:page":d[1]||(d[1]=e=>b.value=e),filters:_.value,"onUpdate:filters":d[2]||(d[2]=e=>_.value=e),total:t(u).clientTotal,items:t(u).clientList,perPage:we,headers:h.value},{"item-avatar":a(e=>[r("img",{src:(e==null?void 0:e.avatar)||t(ae),class:"tw-max-h-8 tw-min-h-8 tw-min-w-8 tw-max-w-8 tw-rounded-full md:tw-min-h-10 md:tw-min-w-10",alt:"avatar"},null,8,pe)]),"item-name":a(e=>[r("p",fe,o(e.firstName)+" "+o(e.lastName),1)]),"item-tags":a(e=>[r("div",ve,[e.tags.total?N("",!0):(p(),V("p",_e,o(t(s)("negative")),1)),(p(!0),V(U,null,ee(e.tags.list.slice(0,3),x=>(p(),C(I,{key:x.id,class:"tw-mr-2",color:"primary"},{default:a(()=>[f(o(x.name),1)]),_:2},1024))),128)),e.tags.list.length-3>0?(p(),C(I,{key:1},{default:a(()=>[f(o(t(s)("plus"))+" "+o(e.tags.list.length-3)+" "+o(t(s)("client.tags")),1)]),_:2},1024)):N("",!0)])]),"item-phone":a(e=>[f(o(e.phone||"-"),1)]),"item-lastSession":a(e=>[f(o(t(D)(e.lastSession).format("HH:mm, D MMMM, YYYY")||"-"),1)]),_:1},8,["onUpdate","page","filters","total","items","headers"])]),_:1})]),_:1},8,["isUpdate"])],64))}});export{Ue as default};
