import{d as X,u as E,i as G,k as d,n as H,o as p,c as V,e,w as a,f as y,t as c,b as l,V as _,af as S,aF as W,a as m,ak as Y,ad as ee,ao as P,aG as te,F as z,B as A,aH as ae,p as J,m as Q,al as le,J as se,am as oe,r as h,h as ie,Z as ne,s as L,q as R}from"./index-BhGVanJs.js";import"./lodash-CVc3FTaT.js";import{_ as re}from"./BaseCard.vue_vue_type_script_setup_true_lang-DB97wE3d.js";import{_ as ue}from"./BaseTable.vue_vue_type_style_index_0_lang-BT_nUUZt.js";import{_ as ce}from"./BaseLoader.vue_vue_type_script_setup_true_lang-BuXkbLdx.js";import{_ as de}from"./DeleteModal.vue_vue_type_script_setup_true_lang-C0QiG3FZ.js";import{_ as me}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-BQNs6tkn.js";import{u as Z}from"./Materials-CwIhrdnp.js";import{u as fe}from"./Rules-CgqIM7pl.js";import"./moment-zH0z38ay.js";const pe={class:"title text-white"},ve={class:"tw-flex tw-items-center tw-mb-5"},_e={class:"tw-mb-3 tw-flex tw-justify-between"},we={class:"tw-flex tw-text-xs tw-text-gray-500"},xe={class:"tw-hidden md:tw-block tw-mr-1"},Ve={class:"tw-text-xs tw-text-gray-500"},ge={class:"tw-flex tw-items-center tw-justify-between tw-p-3"},ke={class:"tw-mr-2 tw-flex tw-items-center tw-truncate tw-text-sm"},be={key:0,class:"tw-flex tw-w-full tw-justify-end"},ye={class:"tw-px-6 tw-text-right tw-text-xs tw-text-gray-500"},he=X({__name:"AddMaterialModal",emits:["update"],setup(K,{emit:i}){const{t:r}=E(),C=Z(),g=G(),{emptyRules:F}=fe(),B=i,f=d(!1),U=d(!1),k=d(!1),b=d([]),w=d(),s=d({name:"",description:"",urls:[],files:[]}),T=H(()=>Math.round(s.value.files.map(u=>u.size).reduce((u,t)=>u+t,0)/(10*1024*1024)*100)/100),N=async()=>{k.value=!0;try{const u=await Promise.all(s.value.files.map(t=>C.saveMaterialFiles(t)));await C.createMaterials({name:s.value.name,description:s.value.description,files:u,urls:s.value.urls}),await B("update"),g.createNotification({title:r("notification.materialCreate"),color:"success"}),s.value={name:"",description:"",urls:[],files:[]},f.value=!1}catch{g.createNotification({title:r("notification.errorNotification"),color:"error"})}k.value=!1},D=()=>{w.value&&s.value.urls.push(w.value),w.value=""},q=u=>{s.value.urls=s.value.urls.filter((t,I)=>I!==u)},v=u=>{const t=u.target;t.files&&(s.value.files=[...t.files].slice(0,12),b.value=[])},x=u=>{const t=[...s.value.files];s.value.files=t.filter((I,M)=>M!==u)};return(u,t)=>{const I=h("TrashIcon"),M=h("PlusIcon"),n=h("FileIcon"),$=h("XIcon");return p(),V(z,null,[e(_,{onClick:t[0]||(t[0]=o=>f.value=!0),class:"tw-mr-3",color:"primary"},{default:a(()=>[y(c(l(r)("materials.сreateMaterials")),1)]),_:1}),e(oe,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=o=>f.value=o),width:"800"},{default:a(()=>[e(S,null,{default:a(()=>[e(W,{class:"pa-4 bg-primary"},{default:a(()=>[m("p",pe,c(l(r)("materials.materialContent")),1)]),_:1}),e(Y,{class:"!tw-px-4"},{default:a(()=>[e(ee,{modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=o=>U.value=o),"lazy-validation":""},{default:a(()=>[e(P,{modelValue:s.value.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.name=o),rules:l(F),label:l(r)("name"),class:"tw-mb-1",required:""},null,8,["modelValue","rules","label"]),e(te,{modelValue:s.value.description,"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.description=o),rules:l(F),label:l(r)("description"),class:"tw-mb-1",required:""},null,8,["modelValue","rules","label"]),(p(!0),V(z,null,A(s.value.urls,(o,j)=>(p(),V("div",{key:o,class:"tw-flex tw-items-center tw-mb-5"},[e(P,{value:o,disabled:"",class:"tw-mr-2","hide-details":""},null,8,["value"]),e(_,{onClick:O=>q(j),color:"error",size:"small",icon:""},{default:a(()=>[e(I)]),_:2},1032,["onClick"])]))),128)),m("div",ve,[e(P,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=o=>w.value=o),label:l(r)("Полезные ссылки"),class:"tw-mr-2","hide-details":""},null,8,["modelValue","label"]),e(_,{onClick:D,color:"primary",size:"small",icon:""},{default:a(()=>[e(M)]),_:1})]),e(ae,{onInput:v,modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o),class:"tw-mb-3",label:"Files",variant:"outlined","prepend-icon":"mdi-image",accept:".pdf,.txt,.docx,.doc,.epub,.jpeg,.png,.xlsx,.xls",multiple:"","hide-details":""},null,8,["modelValue"])]),_:1},8,["modelValue"]),m("div",_e,[m("p",we,[m("span",xe,c(l(r)("materials.now")),1),y(" "+c(T.value)+"/10 MB ",1)]),m("p",Ve,c(l(r)("materials.errorsizeFiles")),1)]),m("div",null,[(p(!0),V(z,null,A(s.value.files,(o,j)=>(p(),J(S,{key:o.size,elevation:"10",class:"tw-mb-3"},{default:a(()=>[m("div",ge,[m("span",ke,[e(n,{class:"tw-mr-1 tw-min-w-6"}),y(" "+c(o.name),1)]),e(_,{onClick:O=>x(j),size:"x-small",color:"error",variant:"tonal",icon:""},{default:a(()=>[e($)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),s.value.files.length===12?(p(),V("div",be,[m("p",ye,c(l(r)("materials.errorcountFiles")),1)])):Q("",!0)])]),_:1}),e(le,null,{default:a(()=>[e(se),e(_,{onClick:t[6]||(t[6]=o=>f.value=!1),color:"error"},{default:a(()=>[y(c(l(r)("close")),1)]),_:1}),e(_,{onClick:N,loading:k.value,disabled:!(T.value<10&&U.value),variant:"flat",color:"primary"},{default:a(()=>[y(c(l(r)("create")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Ce={key:0,class:"tw-mb-6 tw-flex tw-justify-between"},Ue={class:"tw-max-w-60 tw-truncate"},Ie={key:1},Me=10,Se=X({__name:"Materials",setup(K){const{t:i}=E(),r=ie(),C=G(),g=Z(),F=d(1),B=d(-1),f=d(!1),U=d(!0),k=d(!1),b=d(),w=d([{label:i("name"),key:"name",value:null}]),s=H(()=>[{text:i("materials.name"),value:"name",sortable:!0},{text:i("materials.files"),value:"files",sortable:!0},{text:i("materials.actions"),value:"actions",width:200}]),T=()=>{r.push({name:"Learning materials"})},N=v=>{f.value=!0,B.value=v.id},D=async()=>{var v;k.value=!0;try{await g.deleteMaterial(B.value),C.createNotification({title:i("notification.materialDelete"),color:"success"}),await((v=b.value)==null?void 0:v.filter),f.value=!1}catch{C.createNotification({title:i("notification.errorNotification"),color:"error"})}k.value=!1},q=async v=>{await v(),U.value=!1};return(v,x)=>{const u=h("BookIcon"),t=h("router-link"),I=h("TrashIcon");return p(),V(z,null,[e(me,{title:"sidebar.material"}),e(ce,{isUpdate:U.value},{default:a(()=>[e(re,null,{default:a(()=>{var M;return[l(C).user.type==="Therapist"?(p(),V("div",Ce,[e(_,{onClick:T,class:"tw-mr-3",color:"primary"},{default:a(()=>[y(c(l(i)("goBack")),1)]),_:1}),e(he,{onUpdate:(M=b.value)==null?void 0:M.filter},null,8,["onUpdate"])])):Q("",!0),e(de,{onDelete:D,modelValue:f.value,"onUpdate:modelValue":x[0]||(x[0]=n=>f.value=n),title:l(i)("materials.deleteMaterial"),loading:k.value,question:l(i)("materials.deleteMaterialQuestion")},null,8,["modelValue","title","loading","question"]),e(ue,{onUpdate:l(g).getMaterials,onCreated:q,page:F.value,"onUpdate:page":x[1]||(x[1]=n=>F.value=n),filters:w.value,"onUpdate:filters":x[2]||(x[2]=n=>w.value=n),total:l(g).total,items:l(g).list,perPage:Me,headers:s.value,ref_key:"table",ref:b},{"item-name":a(n=>[m("p",Ue,c(n.name),1)]),"item-files":a(n=>[n.files.length?(p(),J(ne,{key:0,color:"primary"},{default:a(()=>[y(c(n.files.length)+" "+c(l(i)("materials.files")),1)]),_:2},1024)):(p(),V("p",Ie,c(l(i)("negative")),1))]),"item-actions":a(n=>[e(t,{to:{name:"Materials details",query:{id:n.id}}},{default:a(()=>[e(L,{text:l(i)("materials.showDetails")},{activator:a(({props:$})=>[e(_,R($,{color:"info",class:"tw-mr-3",variant:"tonal",icon:""}),{default:a(()=>[e(u,{size:"20",class:"text-info","stroke-width":"1.5"})]),_:2},1040)]),_:1},8,["text"])]),_:2},1032,["to"]),e(L,{text:l(i)("delete")},{activator:a(({props:$})=>[e(_,R({onClick:o=>N(n)},$,{color:"error",variant:"tonal",icon:"",flat:""}),{default:a(()=>[e(I,{size:"20",class:"text-error","stroke-width":"1.5"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])]),_:1},8,["onUpdate","page","filters","total","items","headers"])]}),_:1})]),_:1},8,["isUpdate"])],64)}}});export{Se as default};
