import{d as K,u as P,h as Q,i as G,az as L,k as p,n as S,o as B,c as H,e,w as i,f as v,t as r,_ as J,V as m,af as W,aF as X,a,b as n,p as Y,m as Z,ad as ee,s as C,q as b,ae as te,aK as se,ai as ae,ao as le,aN as oe,al as ie,am as ne,r as U}from"./index-BhGVanJs.js";import{h as d}from"./moment-zH0z38ay.js";import{j as re}from"./maska-Cp-LWreF.js";import{u as ue}from"./Sessions-BbabeFQp.js";import{u as ce}from"./Client-Dmb9Ytlu.js";import{u as de}from"./Rules-CgqIM7pl.js";const me={class:"tw-flex tw-items-center tw-justify-between"},ve={class:"title text-white"},pe={class:"!tw-p-4 !tw-pb-0"},we={class:"tw-mb-1 tw-flex tw-items-center tw-justify-between"},fe={class:"tw-text-sm"},_e={class:"tw-mb-1 tw-text-sm"},Ve={class:"tw-mb-1 tw-flex tw-items-center tw-justify-between"},xe={class:"tw-text-sm"},Ce={class:"tw-mb-1 tw-text-sm"},be={class:"repeat tw-flex tw-items-center tw-justify-between"},ye={class:"tw-pl-5 tw-text-base"},ke={class:"tw-flex tw-items-center"},Ie={class:"tw-flex tw-items-center tw-justify-between tw-w-full"},ge={class:"tw-flex tw-items-center"},he={class:"md:tw-block tw-hidden"},w=5*60*1e3,Ae=K({__name:"AddEventModal",props:{title:{type:String,default:"Add Session"},isShowCalendarBtn:{type:Boolean,default:!1}},emits:["update"],setup(y,{emit:A}){const{t:l}=P(),h=Q(),_=ue(),V=G(),M=ce(),{emptyRules:R}=de(),k=A,x="â‚½",D=L({mask:`####### ${x}`,reversed:!0,eager:!0}),N=p(!1),I=p(!1),f=p(!1),O=p(!0),g=p(!1),o=p({clientId:null,startsAt:d.unix(d(Math.ceil(d().valueOf()/w)*w).unix()),durationMinutes:null,note:"",status:"OPEN_FOR_BOOKING",currency:"EUR",costInCents:"",isRecurring:!1}),$=S(()=>[{title:`30 ${l("calendar.minutes")}`,props:{value:30}},{title:`45 ${l("calendar.minutes")}`,props:{value:45}},{title:`60 ${l("calendar.minutes")}`,props:{value:60}},{title:`90 ${l("calendar.minutes")}`,props:{value:90}}]),E=S(()=>M.clientList.map(u=>({title:`${u.firstName} ${u.lastName}`,props:{value:u.id}}))),z=()=>{const u=h.resolve({name:"Calendar Month"});window.open(u.href,"_blank")},j=()=>{o.value={clientId:null,durationMinutes:null,startsAt:d.unix(d(Math.ceil(d().valueOf()/w)*w).unix()),note:"",status:"OPEN_FOR_BOOKING",currency:"EUR",costInCents:"",isRecurring:!1},f.value=!0},q=async()=>{const u=await _.getInstantSession();h.push({name:"video chat",query:{url:u.dailyCoUrl,start:d().valueOf()}})},T=async()=>{var u,t;g.value=!0;try{if(N.value){const c={...o.value,status:"BOOKED",costInCents:Number(o.value.costInCents.replace(` ${x}`,""))*100,startsAt:d.unix(d(Math.ceil(d().valueOf()/w)*w).unix())};await _.createSessions(c),await k("update")}else o.value.clientId?(await _.createSessions({...o.value,status:"BOOKED",costInCents:Number(o.value.costInCents.replace(` ${x}`,""))*100}),await k("update")):(await _.createSessions({note:"",durationMinutes:o.value.durationMinutes,startsAt:o.value.startsAt,status:o.value.status,currency:o.value.currency,costInCents:Number(o.value.costInCents.replace(` ${x}`,""))*100}),await k("update"));V.createNotification({title:l("notification.sessionCreate"),color:"success"}),f.value=!1}catch(c){((t=(u=c==null?void 0:c.response)==null?void 0:u.data)==null?void 0:t.status)===409?V.createNotification({title:l("notification.sessionOverlapsMessage"),color:"error"}):V.createNotification({title:l("notification.errorNotification"),color:"error"})}g.value=!1};return M.getClients({limit:100}).then(()=>{O.value=!1}),(u,t)=>{const c=U("QuestionMarkIcon"),F=U("VueEasyDatePicker");return B(),H("div",null,[e(m,{onClick:j,class:J([{"tw-mb-2":!y.isShowCalendarBtn},"!tw-min-w-full md:tw-mb-0 md:!tw-min-w-fit"]),loading:O.value,color:"primary"},{default:i(()=>[v(r(y.title),1)]),_:1},8,["class","loading"]),e(ne,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=s=>f.value=s),width:"600"},{default:i(()=>[e(W,null,{default:i(()=>[e(X,{class:"pa-4 bg-primary"},{default:i(()=>[a("div",me,[a("p",ve,r(n(l)("sessions.newSession")),1),y.isShowCalendarBtn?(B(),Y(m,{key:0,onClick:z,variant:"outlined"},{default:i(()=>[v(r(n(l)("calendar.showCalendar")),1)]),_:1})):Z("",!0)])]),_:1}),a("div",pe,[e(ee,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=s=>I.value=s),"lazy-validation":""},{default:i(()=>[a("div",null,[a("div",we,[a("p",fe,r(n(l)("sessions.client")),1),e(C,{text:n(l)("sessions.clientModalInfo")},{activator:i(({props:s})=>[e(m,b({icon:"",size:"x-small",variant:"tonal"},s,{class:"tw-scale-75",color:"primary"}),{default:i(()=>[e(c)]),_:2},1040)]),_:1},8,["text"])]),e(te,{modelValue:o.value.clientId,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.clientId=s),items:E.value,class:"tw-mb-3",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),a("div",null,[a("p",_e,[v(r(n(l)("sessions.duration"))+" ",1),t[8]||(t[8]=a("span",{class:"text-error"}," * ",-1))]),e(se,{modelValue:o.value.durationMinutes,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.durationMinutes=s),rules:n(R),items:$.value,class:"tw-mb-3",variant:"outlined",required:""},null,8,["modelValue","rules","items"])]),a("div",null,[a("div",Ve,[a("p",xe,r(n(l)("sessions.price")),1),e(C,{text:n(l)("sessions.priceModalInfo")},{activator:i(({props:s})=>[e(m,b(s,{class:"tw-scale-75",size:"x-small",color:"primary",variant:"tonal",icon:""}),{default:i(()=>[e(c)]),_:2},1040)]),_:1},8,["text"])]),ae(e(le,{modelValue:o.value.costInCents,"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.costInCents=s),disabled:!n(V).user.stripeAttached,class:"tw-mb-3",variant:"outlined"},null,8,["modelValue","disabled"]),[[n(re),void 0,D]])]),a("div",null,[a("p",Ce,[v(r(n(l)("sessions.startTime"))+" ",1),t[9]||(t[9]=a("span",{class:"text-error"}," * ",-1))]),e(F,{modelValue:o.value.startsAt,"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.startsAt=s),"min-date":new Date,disabled:N.value,class:"tw-mb-3","model-type":"timestamp","time-picker-inline":""},null,8,["modelValue","min-date","disabled"])]),a("div",be,[a("p",ye,r(n(l)("sessions.or")),1),a("div",ke,[e(oe,{modelValue:o.value.isRecurring,"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.isRecurring=s),color:"primary","hide-details":""},{label:i(()=>[v(r(n(l)("sessions.repeat")),1)]),_:1},8,["modelValue"]),e(C,{class:"md:tw-hidden",text:"The session will be repeated every week."},{activator:i(({props:s})=>[e(m,b(s,{class:"tw-scale-75",size:"x-small",color:"primary",variant:"tonal",icon:""}),{default:i(()=>[e(c)]),_:2},1040)]),_:1})])])]),_:1},8,["modelValue"])]),e(ie,{class:"pa-4"},{default:i(()=>[a("div",Ie,[a("div",ge,[e(m,{onClick:q,class:"tw-mr-3",color:"primary",variant:"flat"},{default:i(()=>[v(r(n(l)("sessions.quickMeeting")),1)]),_:1}),a("div",he,[e(C,{text:n(l)("sessions.quickMeetingModalInfo")},{activator:i(({props:s})=>[e(m,b(s,{class:"tw-scale-75",size:"x-small",variant:"tonal",color:"primary",icon:""}),{default:i(()=>[e(c)]),_:2},1040)]),_:1},8,["text"])])]),a("div",null,[e(m,{onClick:t[6]||(t[6]=s=>f.value=!1),color:"error"},{default:i(()=>[v(r(n(l)("cancel")),1)]),_:1}),e(m,{onClick:T,loading:g.value,disabled:!I.value,color:"primary",variant:"flat"},{default:i(()=>[v(r(n(l)("create")),1)]),_:1},8,["loading","disabled"])])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ae as _};
