import"./lodash-CVc3FTaT.js";import{h as j}from"./moment-zH0z38ay.js";import{_ as E}from"./BaseCard.vue_vue_type_script_setup_true_lang-DB97wE3d.js";import{_ as J}from"./BaseTable.vue_vue_type_style_index_0_lang-BT_nUUZt.js";import{_ as Q}from"./BaseLoader.vue_vue_type_script_setup_true_lang-BuXkbLdx.js";import{_ as G}from"./DeleteModal.vue_vue_type_script_setup_true_lang-C0QiG3FZ.js";import{_ as K}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-BQNs6tkn.js";import{d as h,u as q,i as F,k as n,n as N,o as M,c as U,e,w as a,f as V,t as c,b as l,V as g,af as O,aF as W,a as L,ak as X,ad as Y,ae as A,al as Z,J as ee,am as te,F as S,m as T,s as D,q as B,p as ae,r as I}from"./index-BhGVanJs.js";import{u as z}from"./Materials-CwIhrdnp.js";import{u as le}from"./Client-Dmb9Ytlu.js";import{u as se}from"./Rules-CgqIM7pl.js";const ie={class:"title text-white"},oe=h({__name:"AssignMaterialModal",setup(P){const{t}=q(),u=z(),f=F(),k=le(),{emptyRules:y}=se(),p=n(!1),m=n(!1),v=n(!1),r=n({clientId:null,materialId:null}),_=N(()=>u.list.map(d=>({title:d.name,props:{value:d.id}}))),b=N(()=>k.clientList.map(d=>({title:`${d.firstName} ${d.lastName}`,props:{value:d.id}}))),C=async()=>{v.value=!0;try{r.value.clientId&&r.value.materialId&&await u.createAssigmentMaterials(r.value.clientId,r.value.materialId),await u.getAssigmentMaterials(),f.createNotification({title:t("notification.materialAdd"),color:"success"}),r.value={clientId:null,materialId:null},m.value=!1}catch{f.createNotification({title:t("notification.errorNotification"),color:"error"})}v.value=!0};return k.getClients({limit:300}),(d,o)=>(M(),U(S,null,[e(g,{onClick:o[0]||(o[0]=s=>m.value=!0),color:"primary",class:"!tw-min-w-full md:!tw-min-w-fit"},{default:a(()=>[V(c(l(t)("materials.materialsForClient")),1)]),_:1}),e(te,{modelValue:m.value,"onUpdate:modelValue":o[5]||(o[5]=s=>m.value=s),width:"600"},{default:a(()=>[e(O,null,{default:a(()=>[e(W,{class:"pa-4 bg-primary"},{default:a(()=>[L("p",ie,c(l(t)("materials.addMaterialsForClient")),1)]),_:1}),e(X,{class:"!tw-pb-0 !tw-pt-5"},{default:a(()=>[e(Y,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=s=>p.value=s),"lazy-validation":""},{default:a(()=>[e(A,{modelValue:r.value.clientId,"onUpdate:modelValue":o[1]||(o[1]=s=>r.value.clientId=s),rules:l(y),items:b.value,label:l(t)("materials.client"),variant:"outlined",required:""},null,8,["modelValue","rules","items","label"]),e(A,{modelValue:r.value.materialId,"onUpdate:modelValue":o[2]||(o[2]=s=>r.value.materialId=s),rules:l(y),items:_.value,label:l(t)("materials.material"),variant:"outlined",required:""},null,8,["modelValue","rules","items","label"])]),_:1},8,["modelValue"])]),_:1}),e(Z,{class:"!tw-pt-0"},{default:a(()=>[e(ee),e(g,{onClick:o[4]||(o[4]=s=>m.value=!1),color:"error"},{default:a(()=>[V(c(l(t)("close")),1)]),_:1}),e(g,{onClick:C,disabled:!p.value,variant:"flat",color:"primary"},{default:a(()=>[V(c(l(t)("save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),re={key:0,class:"tw-mb-3 tw-block tw-justify-end md:tw-flex"},ne={class:"tw-max-w-60 tw-truncate"},me=10,Me=h({__name:"LearningMaterials",setup(P){const{t}=q(),u=z(),f=F(),k=n(1),y=n(-1),p=n(!0),m=n(!1),v=n(!1),r=n(),_=n([]),b=N(()=>[{text:t("materials.name"),value:"name",sortable:!0},{text:t("materials.material"),value:"material",sortable:!0},{text:t("materials.created"),value:"created"},{text:t("materials.actions"),value:"actions"}]),C=s=>{m.value=!0,y.value=s.id},d=async()=>{var s;v.value=!0;try{await u.deleteAssigmentMaterial(y.value),f.createNotification({title:t("notification.materialDelete"),color:"success"}),await((s=r.value)==null?void 0:s.filter),m.value=!1}catch{f.createNotification({title:t("notification.errorNotification"),color:"error"})}v.value=!1},o=async s=>{await Promise.all([s(),u.getMaterials()]),p.value=!1};return f.user.type==="Therapist"?_.value=[{label:t("materials.filterClient"),key:"clientName",value:null},{label:t("materials.filterMaterial"),key:"materialName",value:null}]:_.value=[{label:t("materials.filterMaterial"),key:"materialName",value:null}],(s,w)=>{const $=I("RouterLink"),R=I("BookIcon"),H=I("TrashIcon");return M(),U(S,null,[e(K,{title:"sidebar.material"}),e(Q,{isUpdate:p.value},{default:a(()=>[e(E,null,{default:a(()=>[l(f).user.type==="Therapist"?(M(),U("div",re,[e($,{to:{name:"Materials"},class:"tw-mb-2 tw-block md:tw-mb-0"},{default:a(()=>[e(g,{class:"tw-mr-3 !tw-min-w-full md:!tw-min-w-fit",color:"primary"},{default:a(()=>[V(c(l(t)("materials.showMaterials")),1)]),_:1})]),_:1}),e(oe)])):T("",!0),e(J,{onUpdate:l(u).getAssigmentMaterials,onCreated:o,page:k.value,"onUpdate:page":w[0]||(w[0]=i=>k.value=i),filters:_.value,"onUpdate:filters":w[1]||(w[1]=i=>_.value=i),total:l(u).assigmentTotal,items:l(u).assigmentList,perPage:me,headers:b.value,ref_key:"table",ref:r},{"item-name":a(i=>[L("p",ne,c(i.client.firstName)+" "+c(i.client.lastName),1)]),"item-material":a(i=>[V(c(i.material.name),1)]),"item-created":a(i=>[V(c(l(j)(i.createdAt).format("HH:mm D MMMM")),1)]),"item-actions":a(i=>[e($,{to:{name:"Materials details",query:{id:i.material.id}}},{default:a(()=>[e(D,{text:l(t)("materials.showDetails")},{activator:a(({props:x})=>[e(g,B(x,{color:"info",class:"tw-mr-3",variant:"tonal",icon:""}),{default:a(()=>[e(R,{size:"20",class:"text-info","stroke-width":"1.5"})]),_:2},1040)]),_:1},8,["text"])]),_:2},1032,["to"]),l(f).user.type==="Therapist"?(M(),ae(D,{key:0,text:l(t)("delete")},{activator:a(({props:x})=>[e(g,B({onClick:ue=>C(i)},x,{color:"error",variant:"tonal",flat:"",icon:""}),{default:a(()=>[e(H,{size:"20",class:"text-error","stroke-width":"1.5"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])):T("",!0)]),_:1},8,["onUpdate","page","filters","total","items","headers"])]),_:1})]),_:1},8,["isUpdate"]),e(G,{onDelete:d,modelValue:m.value,"onUpdate:modelValue":w[2]||(w[2]=i=>m.value=i),title:l(t)("materials.deleteMaterial"),loading:v.value,question:l(t)("materials.deleteMaterialQuestion")},null,8,["modelValue","title","loading","question"])],64)}}});export{Me as default};
