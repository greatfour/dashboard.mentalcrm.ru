import{d as A,u as L,i as P,k as c,n as E,o as v,c as b,e as t,w as a,f as V,t as n,b as l,V as g,af as q,aE as J,a as f,ak as Q,ad as Z,an as K,aG as O,aH as W,F as D,B as Y,p as R,m as X,aF as ee,J as te,al as ae,r as U,h as le,Z as se,s as j,q as S}from"./index-rKzDa4TW.js";import"./lodash-CyvJ_RrL.js";import{_ as oe}from"./BaseCard.vue_vue_type_script_setup_true_lang-CXnM25sU.js";import{_ as ie}from"./BaseTable.vue_vue_type_style_index_0_lang-BdcfvIXs.js";import{_ as ne}from"./BaseLoader.vue_vue_type_script_setup_true_lang-DEUrq8Kn.js";import{_ as re}from"./DeleteModal.vue_vue_type_script_setup_true_lang-1BeL1TZf.js";import{_ as ue}from"./BaseBreadcrumb.vue_vue_type_style_index_0_lang-C_OQyfJV.js";import{u as G}from"./Materials-yAxKbNN4.js";import{u as ce}from"./Rules-DZKrv_I-.js";import"./moment-zH0z38ay.js";const de={class:"title text-white"},me={class:"tw-mb-3 tw-flex tw-justify-between"},fe={class:"tw-flex tw-text-xs tw-text-gray-500"},pe={class:"tw-hidden md:tw-block tw-mr-1"},ve={class:"tw-text-xs tw-text-gray-500"},_e={class:"tw-flex tw-items-center tw-justify-between tw-p-3"},we={class:"tw-mr-2 tw-flex tw-items-center tw-truncate tw-text-sm"},xe={key:0,class:"tw-flex tw-w-full tw-justify-end"},Ve={class:"tw-px-6 tw-text-right tw-text-xs tw-text-gray-500"},ge=A({__name:"AddMaterialModal",emits:["update"],setup(H,{emit:i}){const{t:r}=L(),k=G(),_=P(),{emptyRules:C}=ce(),M=i,m=c(!1),y=c(!1),w=c(!1),x=c([]);c();const s=c({name:"",description:"",urls:[],files:[]}),F=E(()=>Math.round(s.value.files.map(d=>d.size).reduce((d,e)=>d+e,0)/(10*1024*1024)*100)/100),I=async()=>{w.value=!0;try{const d=await Promise.all(s.value.files.map(e=>k.saveMaterialFiles(e)));await k.createMaterials({name:s.value.name,description:s.value.description,files:d}),await M("update"),_.createNotification({title:r("notification.materialCreate"),color:"success"}),s.value={name:"",description:"",urls:[],files:[]},m.value=!1}catch{_.createNotification({title:r("notification.errorNotification"),color:"error"})}w.value=!1},$=d=>{const e=d.target;e.files&&(s.value.files=[...e.files].slice(0,12),x.value=[])},B=d=>{const e=[...s.value.files];s.value.files=e.filter((p,h)=>h!==d)};return(d,e)=>{const p=U("FileIcon"),h=U("XIcon");return v(),b(D,null,[t(g,{onClick:e[0]||(e[0]=o=>m.value=!0),class:"tw-mr-3",color:"primary"},{default:a(()=>[V(n(l(r)("materials.сreateMaterials")),1)]),_:1}),t(ae,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),width:"800"},{default:a(()=>[t(q,null,{default:a(()=>[t(J,{class:"pa-4 bg-primary"},{default:a(()=>[f("p",de,n(l(r)("materials.materialContent")),1)]),_:1}),t(Q,{class:"!tw-px-4"},{default:a(()=>[t(Z,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=o=>y.value=o),"lazy-validation":""},{default:a(()=>[t(K,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.name=o),rules:l(C),label:l(r)("name"),class:"tw-mb-1",required:""},null,8,["modelValue","rules","label"]),t(O,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value.description=o),rules:l(C),label:l(r)("description"),class:"tw-mb-1",required:""},null,8,["modelValue","rules","label"]),t(W,{onInput:$,modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),class:"tw-mb-3",label:"Files",variant:"outlined","prepend-icon":"mdi-image",accept:".pdf,.txt,.docx,.doc,.epub,.jpeg,.png,.xlsx,.xls",multiple:"","hide-details":""},null,8,["modelValue"])]),_:1},8,["modelValue"]),f("div",me,[f("p",fe,[f("span",pe,n(l(r)("materials.now")),1),V(" "+n(F.value)+"/10 MB ",1)]),f("p",ve,n(l(r)("materials.errorsizeFiles")),1)]),f("div",null,[(v(!0),b(D,null,Y(s.value.files,(o,N)=>(v(),R(q,{key:o.size,elevation:"10",class:"tw-mb-3"},{default:a(()=>[f("div",_e,[f("span",we,[t(p,{class:"tw-mr-1 tw-min-w-6"}),V(" "+n(o.name),1)]),t(g,{onClick:T=>B(N),size:"x-small",color:"error",variant:"tonal",icon:""},{default:a(()=>[t(h)]),_:2},1032,["onClick"])])]),_:2},1024))),128)),s.value.files.length===12?(v(),b("div",xe,[f("p",Ve,n(l(r)("materials.errorcountFiles")),1)])):X("",!0)])]),_:1}),t(ee,null,{default:a(()=>[t(te),t(g,{onClick:e[5]||(e[5]=o=>m.value=!1),color:"error"},{default:a(()=>[V(n(l(r)("close")),1)]),_:1}),t(g,{onClick:I,loading:w.value,disabled:!(F.value<10&&y.value),variant:"flat",color:"primary"},{default:a(()=>[V(n(l(r)("create")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),ke={key:0,class:"tw-mb-6 tw-flex tw-justify-between"},ye={class:"tw-max-w-60 tw-truncate"},be={key:1},Ce=10,qe=A({__name:"Materials",setup(H){const{t:i}=L(),r=le(),k=P(),_=G(),C=c(1),M=c(-1),m=c(!1),y=c(!0),w=c(!1),x=c(),s=c([{label:i("name"),key:"name",value:null}]),F=E(()=>[{text:i("materials.name"),value:"name",sortable:!0},{text:i("materials.files"),value:"files",sortable:!0},{text:i("materials.actions"),value:"actions",width:200}]),I=()=>{r.push({name:"Learning materials"})},$=e=>{m.value=!0,M.value=e.id},B=async()=>{var e;w.value=!0;try{await _.deleteMaterial(M.value),k.createNotification({title:i("notification.materialDelete"),color:"success"}),await((e=x.value)==null?void 0:e.filter),m.value=!1}catch{k.createNotification({title:i("notification.errorNotification"),color:"error"})}w.value=!1},d=async e=>{await e(),y.value=!1};return(e,p)=>{const h=U("BookIcon"),o=U("router-link"),N=U("TrashIcon");return v(),b(D,null,[t(ue,{title:"sidebar.material"}),t(ne,{isUpdate:y.value},{default:a(()=>[t(oe,null,{default:a(()=>{var T;return[l(k).user.type==="Therapist"?(v(),b("div",ke,[t(g,{onClick:I,class:"tw-mr-3",color:"primary"},{default:a(()=>[V(n(l(i)("goBack")),1)]),_:1}),t(ge,{onUpdate:(T=x.value)==null?void 0:T.filter},null,8,["onUpdate"])])):X("",!0),t(re,{onDelete:B,modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=u=>m.value=u),title:l(i)("materials.deleteMaterial"),loading:w.value,question:l(i)("materials.deleteMaterialQuestion")},null,8,["modelValue","title","loading","question"]),t(ie,{onUpdate:l(_).getMaterials,onCreated:d,page:C.value,"onUpdate:page":p[1]||(p[1]=u=>C.value=u),filters:s.value,"onUpdate:filters":p[2]||(p[2]=u=>s.value=u),total:l(_).total,items:l(_).list,perPage:Ce,headers:F.value,ref_key:"table",ref:x},{"item-name":a(u=>[f("p",ye,n(u.name),1)]),"item-files":a(u=>[u.files.length?(v(),R(se,{key:0,color:"primary"},{default:a(()=>[V(n(u.files.length)+" "+n(l(i)("materials.files")),1)]),_:2},1024)):(v(),b("p",be,n(l(i)("negative")),1))]),"item-actions":a(u=>[t(o,{to:{name:"Materials details",query:{id:u.id}}},{default:a(()=>[t(j,{text:l(i)("materials.showDetails")},{activator:a(({props:z})=>[t(g,S(z,{color:"info",class:"tw-mr-3",variant:"tonal",icon:""}),{default:a(()=>[t(h,{size:"20",class:"text-info","stroke-width":"1.5"})]),_:2},1040)]),_:1},8,["text"])]),_:2},1032,["to"]),t(j,{text:l(i)("delete")},{activator:a(({props:z})=>[t(g,S({onClick:he=>$(u)},z,{color:"error",variant:"tonal",icon:"",flat:""}),{default:a(()=>[t(N,{size:"20",class:"text-error","stroke-width":"1.5"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])]),_:1},8,["onUpdate","page","filters","total","items","headers"])]}),_:1})]),_:1},8,["isUpdate"])],64)}}});export{qe as default};
